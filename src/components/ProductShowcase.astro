---
// src/components/ProductShowcase.astro

// Sample product data - In production, this would come from a CMS/database
const productData = {
  "male-naradie": [
    { 
      id: 1, 
      name: "Makita 6413", 
      image: "/images/male-naradie/brusky.webp",
      pricePerDay: 8,
      category: "Rýchloupinacie sklučovadlo"
    },
    { 
      id: 2, 
      name: "Makita HR2470", 
      image: "/images/male-naradie/cerpadla.webp",
      pricePerDay: 9,
      category: "SDS-PLUS vŕtacie kladivo"
    },
    { 
      id: 3, 
      name: "Makita HM0870C", 
      image: "/images/male-naradie/lesenie.webp",
      pricePerDay: 15,
      category: "SDS-MAX búracie kladivo"
    },
    { 
      id: 4, 
      name: "Makita HM1203C", 
      image: "/images/male-naradie/nadrze.webp",
      pricePerDay: 20,
      category: "SDS-MAX búracie kladivo"
    },
    { 
      id: 5, 
      name: "Makita HR4003C", 
      image: "/images/male-naradie/pily.webp",
      pricePerDay: 20,
      category: "SDS-MAX vŕtacie kladivo"
    },
    { 
      id: 6, 
      name: "Metabo KHE 2660 Quick", 
      image: "/images/male-naradie/vibratory.webp",
      pricePerDay: 17,
      category: "Kombinované kladivo"
    },
    { 
      id: 7, 
      name: "Bosch GBH 5-40 DCE", 
      image: "/images/male-naradie/vrtacky.webp",
      pricePerDay: 22,
      category: "Kombinované kladivo"
    },
    { 
      id: 8, 
      name: "Hilti TE 30-A36", 
      image: "/images/male-naradie/vysavace.webp",
      pricePerDay: 25,
      category: "Akumulátorové kladivo"
    },
    { 
      id: 9, 
      name: "Makita Test", 
      image: "/images/male-naradie/zahrada.webp",
      pricePerDay: 12,
      category: "Záhradná technika"
    },
    { 
      id: 10, 
      name: "Stihl Test", 
      image: "/images/male-naradie/zvaranie.webp",
      pricePerDay: 18,
      category: "Zváracia technika"
    }
  ],
  "stredna-mechanizacia": [
    { 
      id: 11, 
      name: "Vibračná doska BOMAG BPR 35/60", 
      image: "/images/stredna-mechanizacia/vibracne-dosky.webp",
      pricePerDay: 35,
      category: "Vibračná doska"
    },
    { 
      id: 12, 
      name: "Elektrocentrála HONDA EU30i", 
      image: "/images/stredna-mechanizacia/elektrocentraly.webp",
      pricePerDay: 45,
      category: "Elektrocentrála"
    },
    { 
      id: 13, 
      name: "Kompresor ATLAS COPCO XAS 68", 
      image: "/images/stredna-mechanizacia/kompresory.webp",
      pricePerDay: 55,
      category: "Kompresor"
    }
  ],
  "tazka-technika": [
    { 
      id: 14, 
      name: "Mini rýpadlo KUBOTA KX019-4", 
      image: "/images/tazka-technika/mini-rypadla.webp",
      pricePerDay: 120,
      category: "Mini rýpadlo"
    },
    { 
      id: 15, 
      name: "Pásové rýpadlo CAT 320", 
      image: "/images/tazka-technika/tazke-rypadla.webp",
      pricePerDay: 250,
      category: "Ťažké rýpadlo"
    }
  ],
  "pracovne-plosiny": [
    { 
      id: 16, 
      name: "Haulotte COMPACT 10N", 
      image: "/images/pracovne-plosiny/interierove.webp",
      pricePerDay: 80,
      category: "Interiérová plošina"
    }
  ],
  "vybavenie-staveniska": [
    { 
      id: 17, 
      name: "Kancelársky kontajner 6m", 
      image: "/images/vybavenie-staveniska/kontajnery.webp",
      pricePerDay: 150,
      category: "Kancelársky kontajner"
    }
  ],
  "auta-privesy": [
    { 
      id: 18, 
      name: "Prívesný vozík TEMA 2,5t", 
      image: "/images/auta-privesy/privesy.webp",
      pricePerDay: 25,
      category: "Prívesný vozík"
    }
  ]
};

const categories = [
  { 
    id: "male-naradie", 
    name: "Malé náradie",
    icon: `<svg class="w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>`,
    url: "/pozicovna-naradia/male-naradie"
  },
  { 
    id: "stredna-mechanizacia", 
    name: "Stredná mechanizácia",
    icon: `<svg class="w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="6" width="20" height="12" rx="2"/><circle cx="7" cy="12" r="2"/><circle cx="17" cy="12" r="2"/><path d="M12 6v12"/></svg>`,
    url: "/pozicovna-naradia/stredna-mechanizacia"
  },
  { 
    id: "tazka-technika", 
    name: "Ťažká technika",
    icon: `<svg class="w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 20h20M5 20V8l3-3h8l3 3v12M9 20v-8h6v8M12 4V2"/><circle cx="8" cy="14" r="1"/><circle cx="16" cy="14" r="1"/></svg>`,
    url: "/pozicovna-naradia/tazka-technika"
  },
  { 
    id: "pracovne-plosiny", 
    name: "Pracovné plošiny",
    icon: `<svg class="w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="4" rx="1"/><path d="M6 7v10M18 7v10"/><rect x="3" y="17" width="18" height="4" rx="1"/></svg>`,
    url: "/pozicovna-naradia/pracovne-plosiny"
  },
  { 
    id: "vybavenie-staveniska", 
    name: "Vybavenie staveniska",
    icon: `<svg class="w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="8" width="18" height="12" rx="1"/><path d="M7 8V6a2 2 0 012-2h6a2 2 0 012 2v2"/><path d="M12 12v4"/></svg>`,
    url: "/pozicovna-naradia/vybavenie-staveniska"
  },
  { 
    id: "auta-privesy", 
    name: "Autá a prívesy",
    icon: `<svg class="w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 17h14v2.5M7 19.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM20 19.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"/><path d="M5 17V6a1 1 0 011-1h7l3 4h5v8"/></svg>`,
    url: "/pozicovna-naradia/auta-privesy"
  }
];
---

<section class="relative bg-black py-12 lg:py-16" id="productShowcase">
  <div class="max-w-[1800px] mx-auto px-4 md:px-8 lg:px-12 xl:px-16 2xl:px-24">
    
    <!-- Section Header -->
    <div class="text-center mb-10">

      <h2 class="text-3xl md:text-4xl lg:text-5xl font-black text-white mb-3 leading-tight">
        Prenájom náradia a <span class="text-[#FF6600]">stavebných strojov</span>
      </h2>
    </div>

    <!-- Main Content: Categories + Products Grid -->
    <div class="flex flex-col lg:flex-row gap-6 lg:gap-8">
      
      <!-- Category Filter - Left Side -->
      <div class="lg:w-64 shrink-0">
        <div class="sticky top-24">
          <div class="bg-zinc-900/50 backdrop-blur-xl border border-white/10 rounded-2xl p-4 lg:p-5 shadow-xl">
            <h3 class="text-white font-bold text-lg mb-4 px-2">Kategórie</h3>
            
            <div class="space-y-2">
              {categories.map((cat, index) => (
                <button
                  type="button"
                  class={`category-filter-btn w-full flex items-center gap-4 p-4 rounded-xl border-2 transition-all duration-300 ${
                    index === 0 
                      ? 'bg-gradient-to-r from-[#FF6600] to-[#ff8533] border-[#FF6600] text-white shadow-lg shadow-[#FF6600]/30' 
                      : 'bg-white/5 border-white/10 text-white/70 hover:bg-white/10 hover:border-white/20'
                  }`}
                  data-category={cat.id}
                  data-active={index === 0 ? "true" : "false"}
                >
                  <div class="category-icon shrink-0" set:html={cat.icon} />
                  <span class="font-bold text-sm text-left">{cat.name}</span>
                </button>
              ))}
            </div>

            <!-- View All Link -->
            <a 
              href="/pozicovna-naradia" 
              class="mt-6 w-full flex items-center justify-center gap-2 px-4 py-3 bg-white/5 border border-white/10 text-white font-semibold text-sm rounded-xl hover:bg-white/10 hover:border-[#FF6600]/30 transition-all duration-300"
            >
              <span>Všetky kategórie</span>
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
              </svg>
            </a>
          </div>
        </div>
      </div>

      <!-- Products Grid - Right Side -->
      <div class="flex-1">
        
        <!-- Products Container -->
        <div id="productsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5 lg:gap-6 mb-8">
          <!-- Products will be injected here by JavaScript -->
        </div>

        <!-- Pagination -->
        <div id="pagination" class="flex items-center justify-center gap-2 mt-8">
          <!-- Pagination dots will be injected here by JavaScript -->
        </div>

        <!-- No Products Message -->
        <div id="noProducts" class="hidden text-center py-12">
          <div class="w-20 h-20 bg-white/5 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg class="w-10 h-10 text-white/30" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/>
            </svg>
          </div>
          <p class="text-white/60 text-lg">Žiadne produkty v tejto kategórii</p>
        </div>

      </div>
    </div>

  </div>
</section>

<style>
  .category-filter-btn[data-active="true"] .category-icon {
    color: white;
  }
  
  .category-filter-btn[data-active="false"] .category-icon {
    color: rgba(255, 255, 255, 0.5);
  }

  .category-filter-btn:hover .category-icon {
    color: white;
  }

  /* Product card animations */
  .product-card {
    animation: fadeInUp 0.4s ease-out;
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Stagger animation for product cards */
  .product-card:nth-child(1) { animation-delay: 0.05s; }
  .product-card:nth-child(2) { animation-delay: 0.1s; }
  .product-card:nth-child(3) { animation-delay: 0.15s; }
  .product-card:nth-child(4) { animation-delay: 0.2s; }
  .product-card:nth-child(5) { animation-delay: 0.25s; }
  .product-card:nth-child(6) { animation-delay: 0.3s; }
</style>

<script define:vars={{ productData, categories }}>
  // State management
  let currentCategory = 'male-naradie';
  let currentPage = 1;
  const productsPerPage = 6;

  // Get current products based on category and page
  function getCurrentProducts() {
    const allProducts = productData[currentCategory] || [];
    const startIndex = (currentPage - 1) * productsPerPage;
    const endIndex = startIndex + productsPerPage;
    return allProducts.slice(startIndex, endIndex);
  }

  // Get total pages for current category
  function getTotalPages() {
    const allProducts = productData[currentCategory] || [];
    return Math.ceil(allProducts.length / productsPerPage);
  }

  // Render product card
function renderProductCard(product) {
  return `
    <div class="product-card group relative bg-zinc-900/50 backdrop-blur-xl border border-white/10 rounded-2xl overflow-hidden hover:border-[#FF6600]/50 hover:shadow-2xl hover:shadow-[#FF6600]/20 transition-all duration-300 hover:-translate-y-1">
      <!-- Product Image -->
      <div class="relative h-56 bg-white overflow-hidden">
        <img 
          src="${product.image}" 
          alt="${product.name}"
          class="w-full h-full object-contain object-center p-4 group-hover:scale-110 transition-transform duration-500"
          loading="lazy"
          onerror="this.src='/images/products/placeholder.webp'"
        />
        <!-- Price Badge - Bottom Left -->
        <div class="absolute bottom-3 left-3 px-3 py-1.5 bg-[#FF6600] text-white text-sm font-black rounded-lg shadow-xl">
          ${product.pricePerDay}€/deň
        </div>
      </div>

      <!-- Product Info -->
      <div class="p-5">
        <h3 class="text-white font-bold text-lg mb-2 group-hover:text-[#FF6600] transition-colors duration-300 line-clamp-2">
          ${product.name}
        </h3>
        <p class="text-white/60 text-sm mb-4">${product.category}</p>

        <!-- CTA Buttons -->
        <div class="space-y-2">
          <button
            type="button"
            class="reserve-btn w-full flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-[#FF6600] to-[#ff8533] text-white font-bold text-sm rounded-lg hover:shadow-lg hover:shadow-[#FF6600]/50 transition-all duration-300"
            data-product-id="${product.id}"
            data-product-name="${product.name}"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/>
            </svg>
            <span>REZERVOVAŤ</span>
          </button>

          <button
            type="button"
            class="details-btn w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-white/5 border border-white/10 text-white font-semibold text-sm rounded-lg hover:bg-white/10 hover:border-[#FF6600]/30 transition-all duration-300"
            data-product-id="${product.id}"
          >
            <span>Technické parametre</span>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
  `;
}

  // Render products
  function renderProducts() {
    const container = document.getElementById('productsContainer');
    const noProductsMsg = document.getElementById('noProducts');
    const products = getCurrentProducts();

    if (products.length === 0) {
      container.innerHTML = '';
      noProductsMsg.classList.remove('hidden');
    } else {
      noProductsMsg.classList.add('hidden');
      container.innerHTML = products.map(renderProductCard).join('');
      attachProductEventListeners();
    }

    renderPagination();
  }

  // Render pagination
  function renderPagination() {
    const paginationContainer = document.getElementById('pagination');
    const totalPages = getTotalPages();

    if (totalPages <= 1) {
      paginationContainer.innerHTML = '';
      return;
    }

    const dots = [];
    for (let i = 1; i <= totalPages; i++) {
      const isActive = i === currentPage;
      dots.push(`
        <button
          type="button"
          class="pagination-dot ${isActive ? 'w-8 bg-gradient-to-r from-[#FF6600] to-[#ff8533]' : 'w-3 bg-white/20 hover:bg-white/40'} h-3 rounded-full transition-all duration-300"
          data-page="${i}"
          aria-label="Page ${i}"
          ${isActive ? 'aria-current="page"' : ''}
        ></button>
      `);
    }

    paginationContainer.innerHTML = dots.join('');

    // Attach pagination click handlers
    document.querySelectorAll('.pagination-dot').forEach(dot => {
      dot.addEventListener('click', (e) => {
        const page = parseInt(e.target.dataset.page);
        if (page !== currentPage) {
          currentPage = page;
          renderProducts();
          // Smooth scroll to top of products section
          document.getElementById('productShowcase').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      });
    });
  }

  // Attach event listeners to product buttons
  function attachProductEventListeners() {
    // Reserve buttons
    document.querySelectorAll('.reserve-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const productId = e.currentTarget.dataset.productId;
        const productName = e.currentTarget.dataset.productName;
        
        // Open WhatsApp with pre-filled message
        const message = encodeURIComponent(`Dobrý deň, chcem rezervovať: ${productName}`);
        window.open(`https://wa.me/421948555551?text=${message}`, '_blank');
      });
    });

    // Details buttons
    document.querySelectorAll('.details-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const productId = e.currentTarget.dataset.productId;
        // Navigate to product detail page (you'll need to create these routes)
        // For now, we'll just log it
        console.log(`View details for product ${productId}`);
        alert('Stránka s detailami produktu bude čoskoro dostupná');
      });
    });
  }

  // Category filter click handlers
  document.querySelectorAll('.category-filter-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      const categoryId = e.currentTarget.dataset.category;
      
      if (categoryId === currentCategory) return;

      // Update active state
      document.querySelectorAll('.category-filter-btn').forEach(b => {
        b.dataset.active = 'false';
        b.classList.remove('bg-gradient-to-r', 'from-[#FF6600]', 'to-[#ff8533]', 'border-[#FF6600]', 'shadow-lg', 'shadow-[#FF6600]/30');
        b.classList.add('bg-white/5', 'border-white/10', 'text-white/70');
      });

      e.currentTarget.dataset.active = 'true';
      e.currentTarget.classList.add('bg-gradient-to-r', 'from-[#FF6600]', 'to-[#ff8533]', 'border-[#FF6600]', 'shadow-lg', 'shadow-[#FF6600]/30');
      e.currentTarget.classList.remove('bg-white/5', 'border-white/10', 'text-white/70');

      // Update category and reset page
      currentCategory = categoryId;
      currentPage = 1;
      
      // Render new products
      renderProducts();
    });
  });

  // Initial render
  renderProducts();
</script>